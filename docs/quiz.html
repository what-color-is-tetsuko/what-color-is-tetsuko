<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>黒柳テスト</title>
    <!-- <meta property="og:url"           content="" /> -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="黒柳テスト" />
    <meta property="og:description" content="あなたはなにやなぎ？" />
    <!-- <meta property="og:image"         content="http://www.your-domain.com/path/image.jpg" /> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.2.6/vue.min.js"></script>
    <script src="./app.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <link rel="stylesheet" type="text/css" href="./app.css">
</head>

<body>
    <div class="overlay">
        <div id="app" class="questionBackground">
            <div v-if="questionOpen">
                <p v-html="question.text" class="questionText"></p>
                <p v-model="question.reference"></p>
                <div class="choiceBox">
                    <ul>
                        <li v-for="choice in choices">
                            <button :id="choice" :value="choice" v-model="checkedChoices" v-on:click="answerQuiz(choice)">{{ choice }}</button>
                        </li>
                    </ul>
                </div>
            </div>

            <div v-if="answerOpen" transition="fade">
                <button class="button is-primary" v-on:click="nextQuiz">次の問題</button>
            </div>

            <div v-if="endOpen" transition="fade">
                <h2>正答数： {{ correctNum }} / {{ questionIndex }}</h2>

                <div class="sns">
                    <a href="" target="_blank" title="Facebookでシェア"><img src="./assets/button_facebook.png" alt="facebook"></a>
                    <a v-bind:href="'https://twitter.com/intent/tweet?text=' + '私は' + yanagi[correctNum] + '柳徹子でした' + '%0Ahttp://tetsuco.com'"
                        target="_blank" title="Twitterでシェア"><img src="./assets/button_twitter.png" alt="twitter"></a>
                    <a href="" target="_blank" title="LINEに送る"><img src="./assets/button_LINE.png" alt="LINE"></a>
                </div>

                <button class="button is-primary" v-on:click="initializeApp">もう１度！</button>
            </div>
        </div>
    </div>
    <div class="bgmovie">
        <div id="player">
        </div>
    </div>

</body>

<script>
    new Vue({
        el: '#app',
        // データ
        data: {
            questions: {},
            question: {
                problem: '',
                answer: ''
            },
            choices: [],
            checkedChoices: [],
            isCorrect: false,
            isAnswerButtonDisabled: true,
            answerOpen: false,
            questionOpen: true,
            endOpen: false,
            questionIndex: 0,
            correctNum: 0,
            shuffledArr: [],
            yanagi: {}
        },
        methods: {
            // 回答する
            answerQuiz: function (answer) {
                console.log('a')
                console.log(answer)
                console.log(this.question.corrects[0])
                console.log('b')

                // 項目を未選択の場合進まない
                // if (this.checkedChoices.length === 0) return
                // 正解を開き正誤の結果を表示する
                this.answerOpen = true
                this.isAnswerButtonDisabled = true
                this.isCorrect = this.compareArr(answer, this.question.corrects[0])
                if (this.isCorrect) this.correctNum++

                // nextQuizのそのまんま入れた
                this.answerOpen = false
                this.questionIndex++

                // questionIndex + 1と問題総数が一緒の場合、終わりページを開く
                if (this.questionIndex === (this.questions.length + 1)) {
                    this.questionIndex = this.questions.length
                    this.questionOpen = false
                    this.endOpen = true
                    window.scrollTo(0, 0)
                } else {
                    // questionに次の問題をセットする
                    var n = this.questionIndex - 1
                    this.question = this.questions[n]

                    // 選択肢を生成する correctsとincorrectsを繋げシャッフル

                    var arr = this.question.incorrects
                    arr.push(this.question.corrects[0])
                    this.choices = arr

                    this.checkedChoices = []
                    window.scrollTo(0, 0)
                }
            },

            initializeApp: function () {
                console.log('init')

                var yanagi =
                    {
                        '0': '白',
                        '1': 'ほぼ',
                        '2': '黒'
                    }

                var questions = [
                    {
                        'id': '0001',
                        'text': '徹子の年齢は？',
                        'corrects': [
                            '110歳'
                        ],
                        'incorrects': [
                            '120歳',
                            '1130歳'
                        ],
                        'answer': 'よく考えましょう'
                    },
                    {
                        'id': '0002',
                        'text': '柳てつこ？',
                        'corrects': [
                            '黒'
                        ],
                        'incorrects': [
                            '白',
                            'ほぼ',
                            '赤'
                        ],
                        'answer': 'Black!!!!!!!!'
                    }
                ]

                console.log('init vars')
                // 変数の初期化
                this.questionIndex = 1
                this.correctNum = 0
                this.isCorrect = false
                this.answerOpen = false
                this.questionOpen = true
                this.endOpen = false
                this.checkedChoices = []

                this.yanagi = yanagi

                //  問題の取得
                this.questions = questions

                // // 問題をランダムに並べた配列を作成する
                var questionsNum = this.questions.length
                var arr = []
                for (var i = 0; i < questionsNum; i++) {
                    arr[i] = i
                }

                // questionにquestionsの1問目を設定する
                this.question = this.questions[0]

                // 選択肢を生成する correctsとincorrectsを繋げシャッフル

                // TODO: https://lodash.com/ 使っていい感じにする
                var arr = this.question.incorrects
                arr.push(this.question.corrects[0])
                this.choices = arr
            },
            // 画面生成後実行されるメソッド
            clear() {
                this.msg = ''
            },
            next() {
                this.questionIndex++
            },
            prev() {
                this.questionIndex--
            },
            compareArr: function (arr1, arr2) {

                // 解答数と回答数が異なる場合false
                if (arr1.length !== arr2.length) {
                    return false
                }

                // 解答と回答の内容が異なる場合false
                for (var i = 0; i < arr1.length; i++) {
                    if (arr1[i] !== arr2[i]) {
                        return false
                    }
                }
                return true
            }
        },
        mounted() {
            this.initializeApp()
        }
    })

</script>

</html>