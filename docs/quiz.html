<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>黒柳テスト</title>
    <!-- <meta property="og:url"           content="" /> -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="黒柳テスト" />
    <meta property="og:description" content="あなたはなにやなぎ？" />
    <!-- <meta property="og:image"         content="http://www.your-domain.com/path/image.jpg" /> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.2.6/vue.min.js"></script>
    <script src="./app.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <link rel="stylesheet" type="text/css" href="./app.css">
</head>

<body>
    <div class="overlay">
        <div id="app">
            <div v-if="questionOpen" class="questionBackground">
                <p v-html="question.text" class="questionText"></p>
                <p v-model="question.reference"></p>
                <div class="choiceBox">
                    <ul>
                        <li v-for="choice in choices">
                            <button :id="choice" :value="choice" v-model="checkedChoices" v-on:click="answerQuiz(choice)">{{ choice }}</button>
                        </li>
                    </ul>
                </div>
            </div>

            <div v-if="answerOpen" transition="fade">
                <button class="button is-primary" v-on:click="nextQuiz">次の問題</button>
            </div>

            <div v-if="endOpen" transition="fade" class="resultBackground">
                <div class="resultContents">
                    <div class="rightBox">
                        <img src="./assets/silhouette.png">
                    </div>
                    <div class="leftBox">
                        <h2 class="resultText">正答数： {{ correctNum }} / {{ questionIndex }}（ここはなんとか柳にかわるよ）</h2>
                    </div>
                    <div class="leftBox">
                        <button class="button is-primary" v-on:click="initializeApp"><img src="./assets/button_retry.png"></button>
                    </div>
                </div>
                <div class="sns">
                    <a href="" target="_blank" title="Facebookでシェア"><img src="./assets/button_facebook.png" alt="facebook"></a>
                    <a v-bind:href="'https://twitter.com/intent/tweet?text=' + '私は' + yanagi[correctNum] + '柳徹子でした' + '%0Ahttp://tetsuco.com'"
                        target="_blank" title="Twitterでシェア"><img src="./assets/button_twitter.png" alt="twitter"></a>
                    <a href="" target="_blank" title="LINEに送る"><img src="./assets/button_LINE.png" alt="LINE"></a>
                </div>
            </div>
        </div>
    </div>
    <div class="bgmovie">
        <div id="player">
        </div>
    </div>

</body>

<script>
    new Vue({
        el: '#app',
        // データ
        data: {
            questions: {},
            question: {
                problem: '',
                answer: ''
            },
            choices: [],
            checkedChoices: [],
            isCorrect: false,
            isAnswerButtonDisabled: true,
            answerOpen: false,
            questionOpen: true,
            endOpen: false,
            questionIndex: 0,
            correctNum: 0,
            shuffledArr: [],
            yanagi: {}
        },
        methods: {
            // 回答する
            answerQuiz: function (answer) {
                console.log(this.question.corrects[0])

                // 項目を未選択の場合進まない
                // if (this.checkedChoices.length === 0) return
                // 正解を開き正誤の結果を表示する
                this.answerOpen = true
                this.isAnswerButtonDisabled = true
                this.isCorrect = this.compareArr(answer, this.question.corrects[0])
                if (this.isCorrect) this.correctNum++

                // nextQuizのそのまんま入れた
                this.answerOpen = false
                this.questionIndex++

                // questionIndex + 1と問題総数が一緒の場合、終わりページを開く
                if (this.questionIndex === (this.questions.length + 1)) {
                    this.questionIndex = this.questions.length
                    this.questionOpen = false
                    this.endOpen = true
                    window.scrollTo(0, 0)
                } else {
                    // questionに次の問題をセットする
                    var n = this.questionIndex - 1
                    this.question = this.questions[n]

                    // 選択肢を生成する correctsとincorrectsを繋げシャッフル

                    var arr = this.question.incorrects
                    arr.push(this.question.corrects[0])
                    this.choices = arr

                    this.checkedChoices = []
                    window.scrollTo(0, 0)
                }
            },

            initializeApp: function () {
                console.log('init')

                var yanagi =
                    {
                        '0': '白',
                        '1': 'ほぼ',
                        '2': '黒'
                    }

                var questions = [
                    {
                        'id': '0001',
                        'text': '「トットちゃん」の愛称で知られる彼女ですが、もうひとつの愛称は何？',
                        'corrects': [
                            'チャック'
                        ],
                        'incorrects': [
                            'カルパッチョ斎藤',
                            'ジッパー',
                            'ジョンソン2号'
                        ],
                    },
                    {
                        'id': '0002',
                        'text': '彼女の足のサイズは24cmだということは当たり前の事実ですが、では何年に生まれたでしょう？',
                        'corrects': [
                            '1933年'
                        ],
                        'incorrects': [
                            '1913年',
                            '1923年',
                            '1943年'
                        ],
                    },
                    {
                        'id': '0003',
                        'text': '彼女が日本チャップリン協会の名誉会長を務めることはご存知だとは思いますが、彼女の血液型は何型でしょう？',
                        'corrects': [
                            'A型'
                        ],
                        'incorrects': [
                            'B型',
                            'AB型',
                            '髪型'
                        ],
                    },
                    {
                        'id': '0004',
                        'text': '『徹子の部屋』が1976年2月にスタートしたことは誰もが知っている周知の事実ですが、2015年5月27日に"ギネス"の世界記録「同一の司会者による番組の最多放送回数記録」を更新したのは何回目の放送の時？',
                        'corrects': [
                            '1,000'
                        ],
                        'incorrects': [
                            '5,000',
                            '10,000',
                            '30,000'
                        ],
                    },
                    {
                        'id': '0005',
                        'text': '1971年のニューヨークへの留学以来「圧迫感がないからいい」という理由からノーブラで過ごしているのはさすがに知っていると思いますが、彼女が尊敬する司会者はだれ？',
                        'corrects': [
                            'エド・サリヴァン'
                        ],
                        'incorrects': [
                            'ゲリー・スコッティ',
                            'ルイス・ターナー',
                            'みのもんた'

                        ],
                    },
                    {
                        'id': '0006',
                        'text': '1984年3月14日放送のフジテレビ『笑っていいとも!』の名物コーナー「テレフォンショッキング」に出演した際に、どんな伝説を残したでしょうか。',
                        'corrects': [
                            '番組で40分以上も喋り続けた'
                        ],
                        'incorrects': [
                            'タモリさんのサングラスをずらした',
                            '美少女戦士セーラームーンのコスプレをしてきた',
                            '予定されていた時間に現れずドタキャンをした'
                        ],
                    },
                    {
                        'id': '0007',
                        'text': 'タモリが『徹子の部屋』にゲストとして出演する際には、何らかの「密室芸」の披露をしていたことは有名すぎるお話ですが、80年代の放送で2人が作って食べていないゲテモノ料理はどれ？',
                        'corrects': [
                            'マヨネーズ石狩鍋'
                        ],
                        'incorrects': [
                            'たくあんを洗った水で作ったクリームソーダ',
                            'チョコレートしゃぶしゃぶ',
                            'ずんだ餅カレー'
                        ],
                    },
                ]

                console.log('init vars')
                // 変数の初期化
                this.questionIndex = 1
                this.correctNum = 0
                this.isCorrect = false
                this.answerOpen = false
                this.questionOpen = true
                this.endOpen = false
                this.checkedChoices = []

                this.yanagi = yanagi

                //  問題の取得
                this.questions = questions

                // // 問題をランダムに並べた配列を作成する
                var questionsNum = this.questions.length
                var arr = []
                for (var i = 0; i < questionsNum; i++) {
                    arr[i] = i
                }

                // questionにquestionsの1問目を設定する
                this.question = this.questions[0]

                // 選択肢を生成する correctsとincorrectsを繋げシャッフル

                // TODO: https://lodash.com/ 使っていい感じにする
                var arr = this.question.incorrects
                arr.push(this.question.corrects[0])
                this.choices = arr
            },
            // 画面生成後実行されるメソッド
            clear() {
                this.msg = ''
            },
            next() {
                this.questionIndex++
            },
            prev() {
                this.questionIndex--
            },
            compareArr: function (arr1, arr2) {

                // 解答数と回答数が異なる場合false
                if (arr1.length !== arr2.length) {
                    return false
                }

                // 解答と回答の内容が異なる場合false
                for (var i = 0; i < arr1.length; i++) {
                    if (arr1[i] !== arr2[i]) {
                        return false
                    }
                }
                return true
            }
        },
        mounted() {
            this.initializeApp()
        }
    })

</script>

</html>